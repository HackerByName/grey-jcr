- var title = 'News'

doctype html
html
	head
		include ../head.jade
		script(src="/javascripts/vue.js")
	body
		div(class='ui container')
			include ../header.jade
			include ../menu.jade
			div(class="ui vertical segment" id="blog")
				h2= title
				div(class="ui divided items")
					div(class="item" v-for="post in posts")
						div(class="content")
							a(class="header" v-bind:href='"/jcr/blog/"+post.author.slug+"/"+post.timestamp.getFullYear()+"/"+(post.timestamp.getMonth()+1)+"/"+post.slug') {{post.title}}
							div(class="meta")
								span(class="author")
									i(class="ui user icon")
									{{ post.author.name }} ({{ post.author.title }})
								span(class="timestamp")
									i(class="ui clock icon")
									{{ post.timestamp }}
							div(class="article description") {{{ post.message }}}
					
				div(class="ui pagination menu")
					a(class="item" v-for="n in pages"  v-bind:class="{'active': (n+1 == page)}" v-on:click.stop="setPage(n+1)") {{ n+1 }}
		include ../footer.jade

		script.
			var blog = new Vue({
				el: "#blog",
				data: {
					total: 0,
					posts: [],
					limit: 8,
					page: 1
				},
				computed:{
					pages: function() {return Math.ceil(this.total/this.limit)}
				},
				methods: {
					fetchPosts: function() {
						var self = this;
						$.get('/api/blog?page='+self.page+'&length='+self.limit, function(response) {
							self.total = response.total;
							for (i = 0; i < response.data.length; i++ ){
								response.data[i].timestamp = new Date(response.data[i].timestamp);
							}
							self.posts = response.data;
						}, 'json');
					},
					setPage: function (page) {
						this.page = page;
					}
				},
				created: function() {
					this.fetchPosts();
				},
				watch: {
					'page': 'fetchPosts',
					'limit': 'fetchPosts'
				}
			});